<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axon BBS - Product Requirements Document 10.5.1</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #1a1a1b;
            color: #d7dadc;
        }
        main {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background-color: #272729;
            border: 1px solid #343536;
            border-radius: 8px;
        }
        h1, h2, h3, h4 {
            color: #ffffff;
            border-bottom: 1px solid #343536;
            padding-bottom: 10px;
        }
        h1 {
            font-size: 2.2em;
        }
        h2 {
            font-size: 1.8em;
            margin-top: 40px;
        }
        h3 {
            font-size: 1.4em;
            border-bottom: none;
            margin-top: 30px;
        }
        h4 {
            font-size: 1.1em;
            border-bottom: none;
            margin-top: 20px;
            color: #d7a248;
        }
        p {
            margin-bottom: 1em;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin-bottom: 0.5em;
        }
        code {
            background-color: #1a1a1b;
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            border-radius: 3px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
        }
        pre {
            background-color: #1a1a1b;
            border: 1px solid #343536;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            white-space: pre;
        }
        strong {
            color: #d7a248;
        }
    </style>
</head>
<body>
    <main>
        <h1>Axon BBS - Product Requirements Document</h1>
        <p><strong>Version:</strong> 10.5.1 (Fortress Overlord Integration)</p>
        <p><strong>Date:</strong> September 13, 2025</p>

        <hr>

        <h2>1. Overview</h2>
        <p>Axon BBS is a modern, anonymous bulletin board system built on a private, federated network of trusted nodes. It prioritizes user privacy and architectural resilience through a custom P2P data synchronization protocol named BitSync. This version introduces a powerful, generic architecture for creating persistent, pseudo-real-time multiplayer games and applications via a server-side Agent-as-a-User model and a message-board-based Event Bus. This document consolidates all previous versions and serves as the definitive guide for the platform's current state.</p>

        <hr>

        <h2>2. User Roles & Stories</h2>
        
        <h3>As a User...</h3>
        <p>A standard participant on the BBS. Their focus is on communication, personalization, and interacting with the applications hosted on the platform.</p>
        <ul>
            <li>I want to generate or import my cryptographic identity, so that I can securely and anonymously interact with the system.</li>
            <li>I want to securely back up my private key, so that I can recover my account and preserve my identity if I lose access to my primary device.</li>
            <li>I want to upload a profile avatar, so that I can personalize my identity and be more recognizable to others.</li>
            <li>I want to unlock my identity once per session for cryptographic actions, such as sending messages or saving game data, to ensure my private key is not held in memory unnecessarily.</li>
            <li>I want to send and receive E2E encrypted private messages, so I can communicate securely with other users without the server or admins being able to read my conversations.</li>
            <li>I want to post on public message boards, so I can participate in community discussions.</li>
            <li>I want to choose a unique nickname, to create a persistent and recognizable handle that is distinct from my username.</li>
            <li>I want to run sandboxed games and applications (applets), so I can enjoy interactive content securely without risk to my device or data.</li>
            <li>I want my progress in an applet to be saved automatically, so that I can pick up where I left off without manual intervention.</li>
            <li>I want to play persistent games that continue to run while I am offline, allowing for a dynamic game world where events can happen even when I am not logged in.</li>
            <li>I want to view a federated high score board for games, so I can compare my performance with all players across the entire network.</li>
        </ul>

        <h3>As an Applet Developer...</h3>
        <p>A technical user who creates the games and utilities that run on the BBS. Their needs revolve around a simple, secure, and powerful API.</p>
        <ul>
            <li>I want to package my application as a single, self-contained JavaScript file, for easy distribution and installation by a SysOp.</li>
            <li>I want a simple, secure API to save and load my applet's private data, so that user progress is encrypted and tied to their identity.</li>
            <li>I want an API to post public "action" messages to a designated message board for my game, so that my applet can broadcast player actions to the entire network.</li>
            <li>I want an API to read the public event log for my game from its message board, so my applet can react to game state changes initiated by other players or server agents.</li>
            <li>I want to provide a server-side agent script that defines the rules and logic for my game, which will run persistently to manage the game world.</li>
            <li>I want assurance that my applet and its agent will run in a secure, sandboxed environment, to protect both the server and the users.</li>
        </ul>

        <h3>As a SysOp (System Operator/Admin)...</h3>
        <p>The administrator of a BBS node. They are responsible for maintenance, user management, content curation, and federation with other nodes.</p>
        <ul>
            <li>I want all the powers of a standard User and Moderator.</li>
            <li>I want to manage a whitelist of trusted federated peers, to control which other BBS nodes my instance will synchronize with.</li>
            <li>I want to add new applets by uploading their source code, to provide new content for my users.</li>
            <li>I want to create and manage categories for applets (e.g., 'Game', 'Utility'), to keep the applet library organized.</li>
            <li>I want to create special "agent" user accounts that can run persistently in the background, to enable persistent multiplayer games.</li>
            <li>I want to assign a specific message board to an applet to act as its official "Event Bus", to provide a dedicated channel for that applet's public game events.</li>
        </ul>

        <hr>

        <h2>3. The Agent & Event-Bus Architecture</h2>
        <p>To support persistent, pseudo-real-time multiplayer applets, Axon BBS provides a generic, reusable architecture. This system is not hard-coded to any specific game and is designed to be secure and scalable.</p>
        
        <h3>The Agent-as-a-User Model</h3>
        <p><strong>Concept:</strong> A game's server-side logic is not run as a privileged, system-level service. Instead, it is run as a special, non-player user account (an "Agent").</p>
        <p><strong>Implementation:</strong> A SysOp can create a standard user and enable the <code>is_agent</code> flag in the admin panel. The agent's logic is defined in a corresponding Python service file (e.g., <code>fortress_overlord_agent_service.py</code>) which is automatically loaded and run by the main BBS server at startup.</p>
        <p><strong>Security:</strong> This model enforces the principle of least privilege. The agent has its own cryptographic identity and can only perform actions allowed for its user account. All its public actions are cryptographically signed, ensuring they are authentic and auditable.</p>

        <h3>The Message Board as an Event Bus</h3>
        <p><strong>Concept:</strong> Player actions that affect other players are not sent directly. Instead, they are posted as encrypted, public messages to a dedicated message board that acts as a game-wide event log.</p>
        <p><strong>Implementation:</strong> In the Applet admin panel, a SysOp can assign any MessageBoard to an applet via the <code>event_board</code> field. This board becomes the single source of truth for all public events related to that applet.</p>

        <h3>The "Home Server Authority" Model</h3>
        <p><strong>Concept:</strong> To prevent race conditions in the federated network, only one agent is ever authoritative for resolving an action. The authority is granted to the agent running on the home server of the target of the action.</p>
        <p><strong>Example:</strong> If Player A (on Server A) attacks Player B (on Server B), the "attack" message is seen by all agents. However, only the agent on Server B will process the event because Player B is its local user. All other agents will ignore it.</p>

        <hr>
        
        <h2>4. Full Project File Structure</h2>
        <p>This diagram represents the complete and accurate file structure for the <code>axon_bbs</code> project.</p>
        <pre><code>axon_bbs/
├── .env
├── manage.py
├── requirements.txt
├── media/
│   └── avatars/
├── logs/
│   └── bbs.log
├── data/
│   ├── axon_bbs.sqlite3
│   ├── bitsync_chunks/
│   └── user_data/
├── axon_project/
│   ├── settings.py
│   └── urls.py
├── api/
│   ├── permissions.py
│   ├── serializers.py
│   ├── urls.py
│   └── views.py
├── core/
│   ├── management/
│   │   └── commands/
│   │       ├── ... (management commands) ...
│   ├── migrations/
│   │   ├── ... (migration files) ...
│   └── services/
│       ├── bitsync_service.py
│       ├── encryption_utils.py
│       ├── fortress_overlord_agent_service.py
│       ├── high_score_service.py
│       ├── identity_service.py
│       ├── service_manager.py
│       ├── sync_service.py
│       └── tor_service.py
├── frontend/
│   └── src/
│       ├── applets/
│       │   ├── FortressOverlord.js
│       │   ├── ... (other applets) ...
│       └── components/
│           ├── ... (React components) ...
└── ... (other project files) ...
</code></pre>

        <hr>

        <h2>5. Featured Applet: Fortress Overlord</h2>
        
        <h3>5.1. Overview & Lore</h3>
        <p>Fortress Overlord is a strategic game designed as an applet for the Axon BBS platform where players manage an autonomous fortress and command robotic drones. Gameplay is asynchronous and persistent, with a server-side "Overlord Agent" resolving actions while the player is offline.</p>
        <p>The player's consciousness is inextricably bound to a massive, subterranean Fortress Core, an immense quantum-resonant crystal lattice. They experience the world exclusively through the delayed sensor feeds of their drones. The consciousness requires colossal energy and precise thermal regulation, making the fortress's power and cooling systems critical vulnerabilities.</p>

        <h3>5.2. Core Gameplay Loop</h3>
        <p>The gameplay is a cycle of asynchronous planning, execution by the agent, and analysis of the results.</p>
        <ul>
            <li><strong>Assess:</strong> Log in and review the Command Log, which contains after-action reports from events that occurred while offline.</li>
            <li><strong>Manage:</strong> Queue building upgrades, construct new drones, and manage resource production.</li>
            <li><strong>Command:</strong> Issue high-level, task-based commands (e.g., "Build," "Harvest") to drones via a strategic map.</li>
            <li><strong>Await Results:</strong> Log off. The Overlord Agent resolves commands and simulates fortress operations over time. Outcomes are discovered upon the next login.</li>
        </ul>

        <h3>5.3. Resources & Production</h3>
        <ul>
            <li><strong>Raw Ore:</strong> The base material, gathered from Ore Deposits by drones assigned to a Crystal Mine.</li>
            <li><strong>Crystals:</strong> A refined component produced by a Forge/Smelter from Raw Ore, essential for high-tech construction.</li>
            <li><strong>Future Resources:</strong> Planned resources include Refined Metal, Hydrogen, and Atmospheric Gas.</li>
        </ul>
        
        <h3>5.4. Drones & Core Mechanics</h3>
        <h4>Drone Travel & Logistics</h4>
        <p>Drones have a physical location and a defined speed. The agent calculates travel time based on distance, and the drone must physically travel to its target over several world ticks. A drone is dedicated to a single task at a time, and issuing a new command to a busy drone requires confirmation to cancel its current task.</p>
        <h4>Construction</h4>
        <p>A player initiates construction by selecting a drone, a building type, and a location on the map. The agent then creates a "Construction Site" at the location. The site builds itself automatically over a number of world ticks, and upon completion, the agent replaces the site with the finished building and posts a report.</p>
        <h4>Communication Range</h4>
        <p>The Command Center has a fixed communication radius. Drones operating outside this range will continue their last command but cannot receive new ones. They buffer any event reports and deliver them in a burst upon returning to communication range.</p>

        <h3>5.5. The Console UI</h3>
        <p>The player interacts with the game entirely through a retro-futuristic console UI from a first-person perspective inside their Command Center. The display is not a live feed but a replay of telemetry data packets.</p>
        <ul>
            <li><strong>Central Screen:</strong> Toggles between a Strategic Map, Building Management, and Unit Roster views.</li>
            <li><strong>Telemetry Panel:</strong> Contains a Video Playback Screen for replaying 3D after-action reports and a scrolling Command Log of all events.</li>
            <li><strong>System Gauges:</strong> A bank of gauges provides at-a-glance status on fortress power, internal temperature, pressure, and oxygen levels.</li>
        </ul>

    </main>
</body>
</html>
